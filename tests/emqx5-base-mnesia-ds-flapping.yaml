id: mnesia-ds-flapping
region: sa-east-1
use_spot_instances: true
emqx:
  instance_type: m7i.large
  edition: emqx
  dashboard_default_password: admin
  data_dir: /data/emqx
  extra_volumes:
    - mount_point: /data
      volume_size: 30
      volume_type: gp3
      mount_options: defaults,noatime,discard
  scripts:
    - scripts/create-mqtt-user.sh
  install_source: git
  # git_repo: git@github.com:thalesmg/emqx.git
  git_repo: https://github.com/thalesmg/emqx.git
  # git_ref: 20240815-r58-session-ds-data-mnesia
  git_ref: 79917981d7357bd01a3ed2a03bb80cd43db6c5ff
  cluster_discovery_strategy: singleton
  durable_storage_backend: builtin_local
  durable_sessions_enabled: true
  nodes:
    - role: core
      instance_count: 1

loadgens:
  instance_type: m7i.large
  nodes:
    - type: emqttb
      scenario: '--motto "flapping" --log-level info @sub_flapping -q 1 --clean-start false --cycles 100 --expiry 30 -N 1000 -t "t/+" @g --inflight 1000 --username perftest --password perftest'
    - type: emqttb
      scenario: '--motto "pub" --log-level info @pub -q 1 -N 100 -t t/%n @g --username perftest --password perftest'
